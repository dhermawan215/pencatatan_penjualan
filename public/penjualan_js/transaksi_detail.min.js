var Index=function(){var table;const csrf_token=$('meta[name="_token"]').attr("content"),trId=$("#transaksiId").val();var handleItemtransaksi=function(){table=$("#tableItemTransaksi").DataTable({responsive:!1,autoWidth:!1,pageLength:5,searching:!0,paging:!0,lengthMenu:[[5,10,25,50,100],[5,10,25,50,100]],language:{info:"Menampilkan _START_ - _END_ dari _TOTAL_ data",infoEmpty:"Menampilkan 0 - 0 dari 0 data",infoFiltered:"",zeroRecords:"Data tidak di temukan",loadingRecords:"Loading...",processing:"Processing..."},columnsDefs:[{searchable:!1,target:[0,1]},{orderable:!1,target:[0,1]}],order:[[1,"asc"]],processing:!0,serverSide:!0,ajax:{url:HomeUrl+"/sales/transaksi_item",type:"POST",data:{_token:csrf_token,trId:trId}},columns:[{data:"cbox",orderable:!1},{data:"barang"},{data:"harga"},{data:"qty"},{data:"subtotal"}],drawCallback:function(response){const total=response.json.sum;handleTotal(total)}})},handleBarangDropDown=function(){$("#barangId").change((function(e){e.preventDefault();const idValue=$(this).val();$.ajax({type:"POST",url:HomeUrl+"/sales/barang",data:{_token:csrf_token,idvalue:idValue},success:function(response){const dataResponse=response.data,harga=dataResponse.harga;$("#hargaSatuan").val(harga),$("#stokTotal").html(response.sisa_stok),handleSubTotal(harga)},error:function(response){}})}))},handleSubTotal=function(harga){$("#qtyBarang").change((function(e){e.preventDefault();const valueQty=$(this).val(),subTotal=valueQty*harga;$("#subTotal").val(subTotal)}))},handleTotal=function(total){const value_total=total;$("#total").val(value_total)},handleSubmitDetailPembelian=function(){$("#formTransaksiDetail").submit((function(e){e.preventDefault();const form=$(this);let formData=new FormData(form[0]);$.ajax({type:"POST",url:HomeUrl+"/sales/simpan_transaksi_detail",data:formData,processData:!1,contentType:!1,success:function(response){const json=JSON.stringify(response);let obj=JSON.parse(json);toastr.success("Data Berhasil Ditambahkan","Success"),table.ajax.reload(null,!1)},error:function(response){$.each(response.responseJSON,(function(key,value){toastr.error(value)}))}})}))},handleDelete=function(){$(document).on("click",".btndel",(function(){let id=$(this).data("id");Swal.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(result=>{result.isConfirmed&&$.ajax({type:"DELETE",url:HomeUrl+"/sales/delete_item_tr/"+id,data:{_token:csrf_token},success:function(response){Swal.fire("Deleted!","Your file has been deleted.","success"),table.ajax.reload()},error:function(response){Swal.fire({icon:"error",title:"Oops...",text:"Internal Server Error"})}})})}))},handleFormTotal=function(){$("#formTransaksiTotal").submit((function(e){e.preventDefault();const form=$(this);let formData=new FormData(form[0]);$.ajax({type:"POST",url:HomeUrl+"/sales/simpan_tr_total",data:formData,processData:!1,contentType:!1,success:function(response){toastr.success("Data Berhasil Ditambahkan","Success"),setTimeout(()=>{window.location.href=HomeUrl+"/sales/success/"+response},4e3)},error:function(response){$.each(response.responseJSON,(function(key,value){toastr.error(value)}))}})}))};return{init:function(){handleItemtransaksi(),handleBarangDropDown(),handleSubmitDetailPembelian(),handleDelete(),handleFormTotal()}}}();$(document).ready((function(){Index.init()}));